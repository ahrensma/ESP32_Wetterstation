<!DOCTYPE html>
<html>

<head>
    <title>{{APPNAME}}</title>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>

    <meta http-equiv='refresh' content='10'>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" type="text/css" href="style.css">
    <!-- Canvas Gauges Library -->
    <script src="https://cdn.jsdelivr.net/npm/@mikhus/canvas-gauges@2.1.7/dist/all.min.js"></script>
    <!-- Chart.js for the Real-Time Chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Main tab styles */
        .tab {
            display: none;
        }

        .tab.active {
            display: block;
        }

        .tab-buttons {
            text-align: center;
            margin-bottom: 1em;
        }

        .tab-buttons button {
            padding: 10px 20px;
            margin: 0 5px;
            font-size: 16px;
            cursor: pointer;
        }

        .tab-buttons button.active {
            background-color: #007BFF;
            color: white;
        }

        table {
            margin: auto;
            width: 90%;
        }

        /* Sub-tab styles (for the Second Tab) */
        .sub-tab {
            display: none;
        }

        .sub-tab.active {
            display: block;
        }

        .sub-tab-buttons {
            text-align: center;
            margin-bottom: 1em;
        }

        .sub-tab-buttons button {
            padding: 8px 16px;
            margin: 0 4px;
            font-size: 14px;
            cursor: pointer;
        }

        .sub-tab-buttons button.active {
            background-color: #28a745;
            color: white;
        }
    </style>
    <script>
        // ----- Tab State Persistence -----
        function showTab(tabIndex) {
            localStorage.setItem('activeMainTab', tabIndex);
            const tabs = document.querySelectorAll('.tab');
            const buttons = document.querySelectorAll('.tab-buttons button');
            tabs.forEach((tab, i) => {
                tab.classList.toggle('active', i === tabIndex);
                buttons[i].classList.toggle('active', i === tabIndex);
            });
        }

        function showSubTab(subIndex) {
            localStorage.setItem('activeSubTab', subIndex);
            const subTabs = document.querySelectorAll('.sub-tab');
            const subButtons = document.querySelectorAll('.sub-tab-buttons button');
            subTabs.forEach((tab, i) => {
                tab.classList.toggle('active', i === subIndex);
                subButtons[i].classList.toggle('active', i === subIndex);
            });
        }

        window.onload = () => {
            const activeMainTab = localStorage.getItem('activeMainTab');
            const activeSubTab = localStorage.getItem('activeSubTab');
            showTab(activeMainTab ? parseInt(activeMainTab, 10) : 0);
            showSubTab(activeSubTab ? parseInt(activeSubTab, 10) : 0);

            // Restore chart data if available
            const savedLabels = localStorage.getItem('chartLabels');
            const savedData = localStorage.getItem('chartData');
            if (savedLabels && savedData && window.chart) {
                chart.data.labels = JSON.parse(savedLabels);
                chart.data.datasets[0].data = JSON.parse(savedData);
                chart.update();
            }
        };

        setInterval(addLogEntry, 3000);
    </script>
</head>

<body>
    <center>
        <h2>{{APPNAME}}</h2>
    </center>

    <!-- Main Tab Navigation -->
    <div class="tab-buttons">
        <button onclick="showTab(0)">Sensor 1</button>
        <button onclick="showTab(1)">Sensor 2</button>
    </div>

    <!-- First Tab: Sensor Data Table -->
    <div class="tab active">
        <table>
            <tr class="title">
                <th>Sensor</th>
                <th>Parameter</th>
                <th>Value</th>
                <th>Unit</th>
            </tr>
            <tr class="ads1015">
                <td>ADS1015</td>
                <td>AO0</td>
                <td>{{ads1015_data_ai0}}</td>
                <td>V</td>
            </tr>
            <tr class="ads1015">
                <td></td>
                <td>AO1</td>
                <td>{{ads1015_data_ai1}}</td>
                <td>V</td>
            </tr>
            <tr class="ads1015">
                <td></td>
                <td>AO2</td>
                <td>{{ads1015_data_ai2}}</td>
                <td>V</td>
            </tr>
            <tr class="ads1015">
                <td></td>
                <td>AO3</td>
                <td>{{ads1015_data_ai3}}</td>
                <td>V</td>
            </tr>
            <tr class="bme680">
                <td>BME680</td>
                <td>Temp</td>
                <td>{{bme680_data_temperature}}</td>
                <td>&#176;C</td>
            </tr>
            <tr class="bme680">
                <td></td>
                <td>Humi</td>
                <td>{{bme680_data_humidity}}</td>
                <td>%</td>
            </tr>
            <tr class="bme680">
                <td></td>
                <td>Pres</td>
                <td>{{bme680_data_pressure}}</td>
                <td>mbar</td>
            </tr>
            <tr class="bme680">
                <td></td>
                <td>AQ</td>
                <td>{{bme680_data_airquality}}</td>
                <td>AQI</td>
            </tr>
            <tr class="d6410">
                <td>David 6410</td>
                <td>Wind</td>
                <td>{{d6410_data_windDIR}}</td>
                <td>deg</td>
            </tr>
            <tr class="d6410">
                <td></td>
                <td>Wind</td>
                <td>{{d6410_data_windSPD}}</td>
                <td>m/s</td>
            </tr>
            <tr class="hm330x">
                <td>HM330x</td>
                <td>PM1.0</td>
                <td>{{hm330x_data_PM1}}</td>
                <td>&#181;g/m&#179;</td>
            </tr>
            <tr class="hm330x">
                <td></td>
                <td>PM2.5</td>
                <td>{{hm330x_data_PM25}}</td>
                <td>&#181;g/m&#179;</td>
            </tr>
            <tr class="hm330x">
                <td></td>
                <td>PM10</td>
                <td>{{hm330x_data_PM10}}</td>
                <td>&#181;g/m&#179;</td>
            </tr>
            <tr class="mdws">
                <td>WindSensor</td>
                <td>Wind</td>
                <td>{{mdws_data_windms}}</td>
                <td>m/s</td>
            </tr>
            <tr class="mdws">
                <td></td>
                <td>Temp</td>
                <td>{{mdws_data_temperature}}</td>
                <td>&#176;C</td>
            </tr>
            <tr class="mlx">
                <td>MLX90614</td>
                <td>AmbiTemp</td>
                <td>{{mlx90614_data_AmbiTemp}}</td>
                <td>&#176;C</td>
            </tr>
            <tr class="mlx">
                <td></td>
                <td>ObjTemp</td>
                <td>{{mlx90614_data_ObjTemp}}</td>
                <td>&#176;C</td>
            </tr>
            <tr class="scd4">
                <td>SCD41</td>
                <td>CO2</td>
                <td>{{scd41_data_co2}}</td>
                <td>ppm</td>
            </tr>
            <tr class="scd4">
                <td></td>
                <td>Temp</td>
                <td>{{scd41_data_temperature}}</td>
                <td>&#176;C</td>
            </tr>
            <tr class="scd4">
                <td></td>
                <td>Humi</td>
                <td>{{scd41_data_humidity}}</td>
                <td>%</td>
            </tr>
            <tr class="tsl">
                <td>TSL2591</td>
                <td>LVIS</td>
                <td>{{tsl2591_data_vis}}</td>
                <td>lum</td>
            </tr>
            <tr class="tsl">
                <td></td>
                <td>LNIR</td>
                <td>{{tsl2591_data_nir}}</td>
                <td>lum</td>
            </tr>
            <tr class="tsl">
                <td></td>
                <td>LFULL</td>
                <td>{{tsl2591_data_lux}}</td>
                <td>lux</td>
            </tr>
            <tr class="data">
                <td>Data</td>
                <td>Dewpoint</td>
                <td>{{dewpoint}}</td>
                <td>&#176;C</td>
            </tr>
            <tr class="data">
                <td></td>
                <td>SQM_FREQ</td>
                <td>{{skyquality_freq}}</td>
                <td>a.u.</td>
            </tr>
            <tr class="data">
                <td></td>
                <td>SQM_NORM</td>
                <td>{{skyquality_norm}}</td>
                <td>a.u.</td>
            </tr>
            <tr class="data">
                <td></td>
                <td>AQI</td>
                <td>{{airqualityindex}}</td>
                <td>a.u.</td>
            </tr>
            <tr class="wifi">
                <td>WIFI</td>
                <td>WIFI</td>
                <td>{{wifi_data_WifiSignal}}</td>
                <td>dBm</td>
            </tr>
            <tr class="app">
                <td>APP</td>
                <td>APP Info</td>
                <td>{{APPRELEASE}}</td>
                <td>{{APPDATE}}</td>
            </tr>
        </table>
    </div>

    <!-- Second Main Tab: Contains Sub-Tabs -->
    <div class="tab">
        <table>

            <tr class="title">
                <th>Sensor</th>
                <th>Parameter</th>
                <th>Value</th>
                <th>Unit</th>
            </tr>
            <tr class="bme680">
                <td>BME680</td>
                <td>Temp</td>
                <td>{{json_client_temp}}</td>
                <td>&#176;C</td>
            </tr>
            <tr class="bme680">
                <td></td>
                <td>Humi</td>
                <td>{{json_client_pres}}</td>
                <td>%</td>
            </tr>
            <tr class="bme680">
                <td></td>
                <td>Pres</td>
                <td>{{json_client_humi}}</td>
                <td>mbar</td>
            </tr>
            <tr class="bme680">
                <td></td>
                <td>AQ</td>
                <td>{{json_client_airq}}</td>
                <td>AQI</td>
            </tr>

        </table>

    </div>
</body>

</html>